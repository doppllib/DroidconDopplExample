//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//

#include "J2ObjC_source.h"
#include "Okhttp3InternalFramedErrorCode.h"
#include "Okhttp3InternalFramedFramedConnection.h"
#include "Okhttp3InternalFramedFramedStream.h"
#include "Okhttp3InternalFramedHeadersMode.h"
#include "Okhttp3InternalFramedSettings.h"
#include "Okhttp3InternalFramedStreamResetException.h"
#include "java/io/EOFException.h"
#include "java/io/IOException.h"
#include "java/io/InterruptedIOException.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/InterruptedException.h"
#include "java/lang/Math.h"
#include "java/lang/NullPointerException.h"
#include "java/lang/Thread.h"
#include "java/lang/Throwable.h"
#include "java/net/SocketTimeoutException.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "okio/AsyncTimeout.h"
#include "okio/Buffer.h"
#include "okio/BufferedSource.h"
#include "okio/Sink.h"
#include "okio/Source.h"
#include "okio/Timeout.h"

@class Okhttp3InternalFramedFramedStream_FramedDataSource;

@interface Okhttp3InternalFramedFramedStream () {
 @public
  jint id__;
  Okhttp3InternalFramedFramedConnection *connection_;
  id<JavaUtilList> requestHeaders_;
  id<JavaUtilList> responseHeaders_;
  Okhttp3InternalFramedFramedStream_FramedDataSource *source_;
  Okhttp3InternalFramedFramedStream_StreamTimeout *readTimeout_;
  Okhttp3InternalFramedFramedStream_StreamTimeout *writeTimeout_;
  Okhttp3InternalFramedErrorCode *errorCode_;
}

- (jboolean)closeInternalWithOkhttp3InternalFramedErrorCode:(Okhttp3InternalFramedErrorCode *)errorCode;

- (void)cancelStreamIfNecessary;

- (void)checkOutNotClosed;

- (void)waitForIo;

@end

J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, connection_, Okhttp3InternalFramedFramedConnection *)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, requestHeaders_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, responseHeaders_, id<JavaUtilList>)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, source_, Okhttp3InternalFramedFramedStream_FramedDataSource *)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, readTimeout_, Okhttp3InternalFramedFramedStream_StreamTimeout *)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, writeTimeout_, Okhttp3InternalFramedFramedStream_StreamTimeout *)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream, errorCode_, Okhttp3InternalFramedErrorCode *)

__attribute__((unused)) static jboolean Okhttp3InternalFramedFramedStream_closeInternalWithOkhttp3InternalFramedErrorCode_(Okhttp3InternalFramedFramedStream *self, Okhttp3InternalFramedErrorCode *errorCode);

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_cancelStreamIfNecessary(Okhttp3InternalFramedFramedStream *self);

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_checkOutNotClosed(Okhttp3InternalFramedFramedStream *self);

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_waitForIo(Okhttp3InternalFramedFramedStream *self);

@interface Okhttp3InternalFramedFramedStream_FramedDataSource : NSObject < OkioSource > {
 @public
  Okhttp3InternalFramedFramedStream *this$0_;
  OkioBuffer *receiveBuffer_;
  OkioBuffer *readBuffer_;
  jlong maxByteCount_;
  jboolean closed_;
  jboolean finished_;
}

- (instancetype)initWithOkhttp3InternalFramedFramedStream:(Okhttp3InternalFramedFramedStream *)outer$
                                                 withLong:(jlong)maxByteCount;

- (jlong)readWithOkioBuffer:(OkioBuffer *)sink
                   withLong:(jlong)byteCount;

- (void)waitUntilReadable;

- (void)receiveWithOkioBufferedSource:(id<OkioBufferedSource>)inArg
                             withLong:(jlong)byteCount;

- (OkioTimeout *)timeout;

- (void)close;

- (void)checkNotClosed;

@end

J2OBJC_EMPTY_STATIC_INIT(Okhttp3InternalFramedFramedStream_FramedDataSource)

J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream_FramedDataSource, receiveBuffer_, OkioBuffer *)
J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream_FramedDataSource, readBuffer_, OkioBuffer *)

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream_FramedDataSource *self, Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount);

__attribute__((unused)) static Okhttp3InternalFramedFramedStream_FramedDataSource *new_Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount) NS_RETURNS_RETAINED;

__attribute__((unused)) static Okhttp3InternalFramedFramedStream_FramedDataSource *create_Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount);

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_FramedDataSource_waitUntilReadable(Okhttp3InternalFramedFramedStream_FramedDataSource *self);

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_FramedDataSource_checkNotClosed(Okhttp3InternalFramedFramedStream_FramedDataSource *self);

J2OBJC_TYPE_LITERAL_HEADER(Okhttp3InternalFramedFramedStream_FramedDataSource)

@interface Okhttp3InternalFramedFramedStream_FramedDataSink () {
 @public
  Okhttp3InternalFramedFramedStream *this$0_;
  OkioBuffer *sendBuffer_;
  jboolean closed_;
  jboolean finished_;
}

- (void)emitDataFrameWithBoolean:(jboolean)outFinished;

@end

J2OBJC_FIELD_SETTER(Okhttp3InternalFramedFramedStream_FramedDataSink, sendBuffer_, OkioBuffer *)

inline jlong Okhttp3InternalFramedFramedStream_FramedDataSink_get_EMIT_BUFFER_SIZE();
#define Okhttp3InternalFramedFramedStream_FramedDataSink_EMIT_BUFFER_SIZE 16384LL
J2OBJC_STATIC_FIELD_CONSTANT(Okhttp3InternalFramedFramedStream_FramedDataSink, EMIT_BUFFER_SIZE, jlong)

__attribute__((unused)) static void Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(Okhttp3InternalFramedFramedStream_FramedDataSink *self, jboolean outFinished);

@interface Okhttp3InternalFramedFramedStream_StreamTimeout () {
 @public
  Okhttp3InternalFramedFramedStream *this$0_;
}

@end

@implementation Okhttp3InternalFramedFramedStream

- (instancetype)initWithInt:(jint)id_
withOkhttp3InternalFramedFramedConnection:(Okhttp3InternalFramedFramedConnection *)connection
                withBoolean:(jboolean)outFinished
                withBoolean:(jboolean)inFinished
           withJavaUtilList:(id<JavaUtilList>)requestHeaders {
  Okhttp3InternalFramedFramedStream_initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_(self, id_, connection, outFinished, inFinished, requestHeaders);
  return self;
}

- (jint)getId {
  return id__;
}

- (jboolean)isOpen {
  @synchronized(self) {
    if (errorCode_ != nil) {
      return false;
    }
    if ((((Okhttp3InternalFramedFramedStream_FramedDataSource *) nil_chk(source_))->finished_ || source_->closed_) && (((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(sink_))->finished_ || sink_->closed_) && responseHeaders_ != nil) {
      return false;
    }
    return true;
  }
}

- (jboolean)isLocallyInitiated {
  jboolean streamIsClient = (id__ & 1) == 1;
  return ((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_))->client_ == streamIsClient;
}

- (Okhttp3InternalFramedFramedConnection *)getConnection {
  return connection_;
}

- (id<JavaUtilList>)getRequestHeaders {
  return requestHeaders_;
}

- (id<JavaUtilList>)getResponseHeaders {
  @synchronized(self) {
    [((Okhttp3InternalFramedFramedStream_StreamTimeout *) nil_chk(readTimeout_)) enter];
    @try {
      while (responseHeaders_ == nil && errorCode_ == nil) {
        Okhttp3InternalFramedFramedStream_waitForIo(self);
      }
    }
    @finally {
      [readTimeout_ exitAndThrowIfTimedOut];
    }
    if (responseHeaders_ != nil) return JreRetainedLocalValue(responseHeaders_);
    @throw create_Okhttp3InternalFramedStreamResetException_initWithOkhttp3InternalFramedErrorCode_(errorCode_);
  }
}

- (Okhttp3InternalFramedErrorCode *)getErrorCode {
  @synchronized(self) {
    return JreRetainedLocalValue(errorCode_);
  }
}

- (void)replyWithJavaUtilList:(id<JavaUtilList>)responseHeaders
                  withBoolean:(jboolean)outArg {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:163 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  jboolean outFinished = false;
  @synchronized(self) {
    if (responseHeaders == nil) {
      @throw create_JavaLangNullPointerException_initWithNSString_(@"responseHeaders == null");
    }
    if (self->responseHeaders_ != nil) {
      @throw create_JavaLangIllegalStateException_initWithNSString_(@"reply already sent");
    }
    JreStrongAssign(&self->responseHeaders_, responseHeaders);
    if (!outArg) {
      ((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(self->sink_))->finished_ = true;
      outFinished = true;
    }
  }
  [((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_)) writeSynReplyWithInt:id__ withBoolean:outFinished withJavaUtilList:responseHeaders];
  if (outFinished) {
    [connection_ flush];
  }
}

- (OkioTimeout *)readTimeout {
  return readTimeout_;
}

- (OkioTimeout *)writeTimeout {
  return writeTimeout_;
}

- (id<OkioSource>)getSource {
  return source_;
}

- (id<OkioSink>)getSink {
  @synchronized(self) {
    if (responseHeaders_ == nil && ![self isLocallyInitiated]) {
      @throw create_JavaLangIllegalStateException_initWithNSString_(@"reply before requesting the sink");
    }
  }
  return sink_;
}

- (void)closeWithOkhttp3InternalFramedErrorCode:(Okhttp3InternalFramedErrorCode *)rstStatusCode {
  if (!Okhttp3InternalFramedFramedStream_closeInternalWithOkhttp3InternalFramedErrorCode_(self, rstStatusCode)) {
    return;
  }
  [((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_)) writeSynResetWithInt:id__ withOkhttp3InternalFramedErrorCode:rstStatusCode];
}

- (void)closeLaterWithOkhttp3InternalFramedErrorCode:(Okhttp3InternalFramedErrorCode *)errorCode {
  if (!Okhttp3InternalFramedFramedStream_closeInternalWithOkhttp3InternalFramedErrorCode_(self, errorCode)) {
    return;
  }
  [((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_)) writeSynResetLaterWithInt:id__ withOkhttp3InternalFramedErrorCode:errorCode];
}

- (jboolean)closeInternalWithOkhttp3InternalFramedErrorCode:(Okhttp3InternalFramedErrorCode *)errorCode {
  return Okhttp3InternalFramedFramedStream_closeInternalWithOkhttp3InternalFramedErrorCode_(self, errorCode);
}

- (void)receiveHeadersWithJavaUtilList:(id<JavaUtilList>)headers
  withOkhttp3InternalFramedHeadersMode:(Okhttp3InternalFramedHeadersMode *)headersMode {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:253 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  Okhttp3InternalFramedErrorCode *errorCode = nil;
  jboolean open = true;
  @synchronized(self) {
    if (responseHeaders_ == nil) {
      if ([((Okhttp3InternalFramedHeadersMode *) nil_chk(headersMode)) failIfHeadersAbsent]) {
        errorCode = JreRetainedLocalValue(JreLoadEnum(Okhttp3InternalFramedErrorCode, PROTOCOL_ERROR));
      }
      else {
        JreStrongAssign(&responseHeaders_, headers);
        open = [self isOpen];
        [self java_notifyAll];
      }
    }
    else {
      if ([((Okhttp3InternalFramedHeadersMode *) nil_chk(headersMode)) failIfHeadersPresent]) {
        errorCode = JreRetainedLocalValue(JreLoadEnum(Okhttp3InternalFramedErrorCode, STREAM_IN_USE));
      }
      else {
        id<JavaUtilList> newHeaders = create_JavaUtilArrayList_init();
        [newHeaders addAllWithJavaUtilCollection:responseHeaders_];
        [newHeaders addAllWithJavaUtilCollection:headers];
        JreStrongAssign(&self->responseHeaders_, newHeaders);
      }
    }
  }
  if (errorCode != nil) {
    [self closeLaterWithOkhttp3InternalFramedErrorCode:errorCode];
  }
  else if (!open) {
    [((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_)) removeStreamWithInt:id__];
  }
}

- (void)receiveDataWithOkioBufferedSource:(id<OkioBufferedSource>)inArg
                                  withInt:(jint)length {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:284 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  [((Okhttp3InternalFramedFramedStream_FramedDataSource *) nil_chk(self->source_)) receiveWithOkioBufferedSource:inArg withLong:length];
}

- (void)receiveFin {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:289 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  jboolean open;
  @synchronized(self) {
    ((Okhttp3InternalFramedFramedStream_FramedDataSource *) nil_chk(self->source_))->finished_ = true;
    open = [self isOpen];
    [self java_notifyAll];
  }
  if (!open) {
    [((Okhttp3InternalFramedFramedConnection *) nil_chk(connection_)) removeStreamWithInt:id__];
  }
}

- (void)receiveRstStreamWithOkhttp3InternalFramedErrorCode:(Okhttp3InternalFramedErrorCode *)errorCode {
  @synchronized(self) {
    if (self->errorCode_ == nil) {
      JreStrongAssign(&self->errorCode_, errorCode);
      [self java_notifyAll];
    }
  }
}

- (void)cancelStreamIfNecessary {
  Okhttp3InternalFramedFramedStream_cancelStreamIfNecessary(self);
}

- (void)addBytesToWriteWindowWithLong:(jlong)delta {
  bytesLeftInWriteWindow_ += delta;
  if (delta > 0) [self java_notifyAll];
}

- (void)checkOutNotClosed {
  Okhttp3InternalFramedFramedStream_checkOutNotClosed(self);
}

- (void)waitForIo {
  Okhttp3InternalFramedFramedStream_waitForIo(self);
}

- (void)dealloc {
  RELEASE_(connection_);
  RELEASE_(requestHeaders_);
  RELEASE_(responseHeaders_);
  RELEASE_(source_);
  RELEASE_(sink_);
  RELEASE_(readTimeout_);
  RELEASE_(writeTimeout_);
  RELEASE_(errorCode_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, -1, 1, -1, -1 },
    { NULL, "I", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x21, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOkhttp3InternalFramedFramedConnection;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaUtilList;", 0x1, -1, -1, -1, 2, -1, -1 },
    { NULL, "LJavaUtilList;", 0x21, -1, -1, 3, 2, -1, -1 },
    { NULL, "LOkhttp3InternalFramedErrorCode;", 0x21, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 4, 5, 3, 6, -1, -1 },
    { NULL, "LOkioTimeout;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOkioTimeout;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOkioSource;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LOkioSink;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 7, 8, 3, -1, -1, -1 },
    { NULL, "V", 0x1, 9, 8, -1, -1, -1, -1 },
    { NULL, "Z", 0x2, 10, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x0, 11, 12, -1, 13, -1, -1 },
    { NULL, "V", 0x0, 14, 15, 3, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x20, 16, 8, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, 3, -1, -1, -1 },
    { NULL, "V", 0x0, 17, 18, -1, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, 3, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, 19, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithInt:withOkhttp3InternalFramedFramedConnection:withBoolean:withBoolean:withJavaUtilList:);
  methods[1].selector = @selector(getId);
  methods[2].selector = @selector(isOpen);
  methods[3].selector = @selector(isLocallyInitiated);
  methods[4].selector = @selector(getConnection);
  methods[5].selector = @selector(getRequestHeaders);
  methods[6].selector = @selector(getResponseHeaders);
  methods[7].selector = @selector(getErrorCode);
  methods[8].selector = @selector(replyWithJavaUtilList:withBoolean:);
  methods[9].selector = @selector(readTimeout);
  methods[10].selector = @selector(writeTimeout);
  methods[11].selector = @selector(getSource);
  methods[12].selector = @selector(getSink);
  methods[13].selector = @selector(closeWithOkhttp3InternalFramedErrorCode:);
  methods[14].selector = @selector(closeLaterWithOkhttp3InternalFramedErrorCode:);
  methods[15].selector = @selector(closeInternalWithOkhttp3InternalFramedErrorCode:);
  methods[16].selector = @selector(receiveHeadersWithJavaUtilList:withOkhttp3InternalFramedHeadersMode:);
  methods[17].selector = @selector(receiveDataWithOkioBufferedSource:withInt:);
  methods[18].selector = @selector(receiveFin);
  methods[19].selector = @selector(receiveRstStreamWithOkhttp3InternalFramedErrorCode:);
  methods[20].selector = @selector(cancelStreamIfNecessary);
  methods[21].selector = @selector(addBytesToWriteWindowWithLong:);
  methods[22].selector = @selector(checkOutNotClosed);
  methods[23].selector = @selector(waitForIo);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "unacknowledgedBytesRead_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "bytesLeftInWriteWindow_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "id__", "I", .constantValue.asLong = 0, 0x12, 20, -1, -1, -1 },
    { "connection_", "LOkhttp3InternalFramedFramedConnection;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "requestHeaders_", "LJavaUtilList;", .constantValue.asLong = 0, 0x12, -1, -1, 21, -1 },
    { "responseHeaders_", "LJavaUtilList;", .constantValue.asLong = 0, 0x2, -1, -1, 21, -1 },
    { "source_", "LOkhttp3InternalFramedFramedStream_FramedDataSource;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "sink_", "LOkhttp3InternalFramedFramedStream_FramedDataSink;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "readTimeout_", "LOkhttp3InternalFramedFramedStream_StreamTimeout;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "writeTimeout_", "LOkhttp3InternalFramedFramedStream_StreamTimeout;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "errorCode_", "LOkhttp3InternalFramedErrorCode;", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "ILOkhttp3InternalFramedFramedConnection;ZZLJavaUtilList;", "(ILokhttp3/internal/framed/FramedConnection;ZZLjava/util/List<Lokhttp3/internal/framed/Header;>;)V", "()Ljava/util/List<Lokhttp3/internal/framed/Header;>;", "LJavaIoIOException;", "reply", "LJavaUtilList;Z", "(Ljava/util/List<Lokhttp3/internal/framed/Header;>;Z)V", "close", "LOkhttp3InternalFramedErrorCode;", "closeLater", "closeInternal", "receiveHeaders", "LJavaUtilList;LOkhttp3InternalFramedHeadersMode;", "(Ljava/util/List<Lokhttp3/internal/framed/Header;>;Lokhttp3/internal/framed/HeadersMode;)V", "receiveData", "LOkioBufferedSource;I", "receiveRstStream", "addBytesToWriteWindow", "J", "LJavaIoInterruptedIOException;", "id", "Ljava/util/List<Lokhttp3/internal/framed/Header;>;", "LOkhttp3InternalFramedFramedStream_FramedDataSource;LOkhttp3InternalFramedFramedStream_FramedDataSink;LOkhttp3InternalFramedFramedStream_StreamTimeout;" };
  static const J2ObjcClassInfo _Okhttp3InternalFramedFramedStream = { "FramedStream", "okhttp3.internal.framed", ptrTable, methods, fields, 7, 0x11, 24, 11, -1, 22, -1, -1, -1 };
  return &_Okhttp3InternalFramedFramedStream;
}

@end

void Okhttp3InternalFramedFramedStream_initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_(Okhttp3InternalFramedFramedStream *self, jint id_, Okhttp3InternalFramedFramedConnection *connection, jboolean outFinished, jboolean inFinished, id<JavaUtilList> requestHeaders) {
  NSObject_init(self);
  self->unacknowledgedBytesRead_ = 0;
  JreStrongAssignAndConsume(&self->readTimeout_, new_Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(self));
  JreStrongAssignAndConsume(&self->writeTimeout_, new_Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(self));
  JreStrongAssign(&self->errorCode_, nil);
  if (connection == nil) @throw create_JavaLangNullPointerException_initWithNSString_(@"connection == null");
  if (requestHeaders == nil) @throw create_JavaLangNullPointerException_initWithNSString_(@"requestHeaders == null");
  self->id__ = id_;
  JreStrongAssign(&self->connection_, connection);
  self->bytesLeftInWriteWindow_ = [((Okhttp3InternalFramedSettings *) nil_chk(connection->peerSettings_)) getInitialWindowSizeWithInt:Okhttp3InternalFramedSettings_DEFAULT_INITIAL_WINDOW_SIZE];
  JreStrongAssignAndConsume(&self->source_, new_Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(self, [((Okhttp3InternalFramedSettings *) nil_chk(connection->okHttpSettings_)) getInitialWindowSizeWithInt:Okhttp3InternalFramedSettings_DEFAULT_INITIAL_WINDOW_SIZE]));
  JreStrongAssignAndConsume(&self->sink_, new_Okhttp3InternalFramedFramedStream_FramedDataSink_initWithOkhttp3InternalFramedFramedStream_(self));
  self->source_->finished_ = inFinished;
  self->sink_->finished_ = outFinished;
  JreStrongAssign(&self->requestHeaders_, requestHeaders);
}

Okhttp3InternalFramedFramedStream *new_Okhttp3InternalFramedFramedStream_initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_(jint id_, Okhttp3InternalFramedFramedConnection *connection, jboolean outFinished, jboolean inFinished, id<JavaUtilList> requestHeaders) {
  J2OBJC_NEW_IMPL(Okhttp3InternalFramedFramedStream, initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_, id_, connection, outFinished, inFinished, requestHeaders)
}

Okhttp3InternalFramedFramedStream *create_Okhttp3InternalFramedFramedStream_initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_(jint id_, Okhttp3InternalFramedFramedConnection *connection, jboolean outFinished, jboolean inFinished, id<JavaUtilList> requestHeaders) {
  J2OBJC_CREATE_IMPL(Okhttp3InternalFramedFramedStream, initWithInt_withOkhttp3InternalFramedFramedConnection_withBoolean_withBoolean_withJavaUtilList_, id_, connection, outFinished, inFinished, requestHeaders)
}

jboolean Okhttp3InternalFramedFramedStream_closeInternalWithOkhttp3InternalFramedErrorCode_(Okhttp3InternalFramedFramedStream *self, Okhttp3InternalFramedErrorCode *errorCode) {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:237 condition failed: assert (!Thread.holdsLock(this));");
  @synchronized(self) {
    if (self->errorCode_ != nil) {
      return false;
    }
    if (((Okhttp3InternalFramedFramedStream_FramedDataSource *) nil_chk(self->source_))->finished_ && ((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(self->sink_))->finished_) {
      return false;
    }
    JreStrongAssign(&self->errorCode_, errorCode);
    [self java_notifyAll];
  }
  [((Okhttp3InternalFramedFramedConnection *) nil_chk(self->connection_)) removeStreamWithInt:self->id__];
  return true;
}

void Okhttp3InternalFramedFramedStream_cancelStreamIfNecessary(Okhttp3InternalFramedFramedStream *self) {
  JreAssert((!JavaLangThread_holdsLockWithId_(self)), @"okhttp3/internal/framed/FramedStream.java:447 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  jboolean open;
  jboolean cancel;
  @synchronized(self) {
    cancel = (!((Okhttp3InternalFramedFramedStream_FramedDataSource *) nil_chk(self->source_))->finished_ && self->source_->closed_ && (((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(self->sink_))->finished_ || self->sink_->closed_));
    open = [self isOpen];
  }
  if (cancel) {
    [self closeWithOkhttp3InternalFramedErrorCode:JreLoadEnum(Okhttp3InternalFramedErrorCode, CANCEL)];
  }
  else if (!open) {
    [((Okhttp3InternalFramedFramedConnection *) nil_chk(self->connection_)) removeStreamWithInt:self->id__];
  }
}

void Okhttp3InternalFramedFramedStream_checkOutNotClosed(Okhttp3InternalFramedFramedStream *self) {
  if (((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(self->sink_))->closed_) {
    @throw create_JavaIoIOException_initWithNSString_(@"stream closed");
  }
  else if (self->sink_->finished_) {
    @throw create_JavaIoIOException_initWithNSString_(@"stream finished");
  }
  else if (self->errorCode_ != nil) {
    @throw create_Okhttp3InternalFramedStreamResetException_initWithOkhttp3InternalFramedErrorCode_(self->errorCode_);
  }
}

void Okhttp3InternalFramedFramedStream_waitForIo(Okhttp3InternalFramedFramedStream *self) {
  @try {
    [self java_wait];
  }
  @catch (JavaLangInterruptedException *e) {
    @throw create_JavaIoInterruptedIOException_init();
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(Okhttp3InternalFramedFramedStream)

@implementation Okhttp3InternalFramedFramedStream_FramedDataSource

- (instancetype)initWithOkhttp3InternalFramedFramedStream:(Okhttp3InternalFramedFramedStream *)outer$
                                                 withLong:(jlong)maxByteCount {
  Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(self, outer$, maxByteCount);
  return self;
}

- (jlong)readWithOkioBuffer:(OkioBuffer *)sink
                   withLong:(jlong)byteCount {
  if (byteCount < 0) @throw create_JavaLangIllegalArgumentException_initWithNSString_(JreStrcat("$J", @"byteCount < 0: ", byteCount));
  jlong read;
  @synchronized(this$0_) {
    Okhttp3InternalFramedFramedStream_FramedDataSource_waitUntilReadable(self);
    Okhttp3InternalFramedFramedStream_FramedDataSource_checkNotClosed(self);
    if ([((OkioBuffer *) nil_chk(readBuffer_)) size] == 0) return -1;
    read = [readBuffer_ readWithOkioBuffer:sink withLong:JavaLangMath_minWithLong_withLong_(byteCount, [readBuffer_ size])];
    this$0_->unacknowledgedBytesRead_ += read;
    if (this$0_->unacknowledgedBytesRead_ >= [((Okhttp3InternalFramedSettings *) nil_chk(((Okhttp3InternalFramedFramedConnection *) nil_chk(this$0_->connection_))->okHttpSettings_)) getInitialWindowSizeWithInt:Okhttp3InternalFramedSettings_DEFAULT_INITIAL_WINDOW_SIZE] / 2) {
      [this$0_->connection_ writeWindowUpdateLaterWithInt:this$0_->id__ withLong:this$0_->unacknowledgedBytesRead_];
      this$0_->unacknowledgedBytesRead_ = 0;
    }
  }
  @synchronized(this$0_->connection_) {
    this$0_->connection_->unacknowledgedBytesRead_ += read;
    if (this$0_->connection_->unacknowledgedBytesRead_ >= [((Okhttp3InternalFramedSettings *) nil_chk(this$0_->connection_->okHttpSettings_)) getInitialWindowSizeWithInt:Okhttp3InternalFramedSettings_DEFAULT_INITIAL_WINDOW_SIZE] / 2) {
      [this$0_->connection_ writeWindowUpdateLaterWithInt:0 withLong:this$0_->connection_->unacknowledgedBytesRead_];
      this$0_->connection_->unacknowledgedBytesRead_ = 0;
    }
  }
  return read;
}

- (void)waitUntilReadable {
  Okhttp3InternalFramedFramedStream_FramedDataSource_waitUntilReadable(self);
}

- (void)receiveWithOkioBufferedSource:(id<OkioBufferedSource>)inArg
                             withLong:(jlong)byteCount {
  JreAssert((!JavaLangThread_holdsLockWithId_(this$0_)), @"okhttp3/internal/framed/FramedStream.java:384 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  while (byteCount > 0) {
    jboolean finished;
    jboolean flowControlError;
    @synchronized(this$0_) {
      finished = self->finished_;
      flowControlError = (byteCount + [((OkioBuffer *) nil_chk(readBuffer_)) size] > maxByteCount_);
    }
    if (flowControlError) {
      [((id<OkioBufferedSource>) nil_chk(inArg)) skipWithLong:byteCount];
      [this$0_ closeLaterWithOkhttp3InternalFramedErrorCode:JreLoadEnum(Okhttp3InternalFramedErrorCode, FLOW_CONTROL_ERROR)];
      return;
    }
    if (finished) {
      [((id<OkioBufferedSource>) nil_chk(inArg)) skipWithLong:byteCount];
      return;
    }
    jlong read = [((id<OkioBufferedSource>) nil_chk(inArg)) readWithOkioBuffer:receiveBuffer_ withLong:byteCount];
    if (read == -1) @throw create_JavaIoEOFException_init();
    byteCount -= read;
    @synchronized(this$0_) {
      jboolean wasEmpty = [readBuffer_ size] == 0;
      [readBuffer_ writeAllWithOkioSource:receiveBuffer_];
      if (wasEmpty) {
        [this$0_ java_notifyAll];
      }
    }
  }
}

- (OkioTimeout *)timeout {
  return this$0_->readTimeout_;
}

- (void)close {
  @synchronized(this$0_) {
    closed_ = true;
    [((OkioBuffer *) nil_chk(readBuffer_)) clear];
    [this$0_ java_notifyAll];
  }
  Okhttp3InternalFramedFramedStream_cancelStreamIfNecessary(this$0_);
}

- (void)checkNotClosed {
  Okhttp3InternalFramedFramedStream_FramedDataSource_checkNotClosed(self);
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(receiveBuffer_);
  RELEASE_(readBuffer_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x2, -1, 0, -1, -1, -1, -1 },
    { NULL, "J", 0x1, 1, 2, 3, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, 3, -1, -1, -1 },
    { NULL, "V", 0x0, 4, 5, 3, -1, -1, -1 },
    { NULL, "LOkioTimeout;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 3, -1, -1, -1 },
    { NULL, "V", 0x2, -1, -1, 3, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOkhttp3InternalFramedFramedStream:withLong:);
  methods[1].selector = @selector(readWithOkioBuffer:withLong:);
  methods[2].selector = @selector(waitUntilReadable);
  methods[3].selector = @selector(receiveWithOkioBufferedSource:withLong:);
  methods[4].selector = @selector(timeout);
  methods[5].selector = @selector(close);
  methods[6].selector = @selector(checkNotClosed);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", "LOkhttp3InternalFramedFramedStream;", .constantValue.asLong = 0, 0x1012, -1, -1, -1, -1 },
    { "receiveBuffer_", "LOkioBuffer;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "readBuffer_", "LOkioBuffer;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "maxByteCount_", "J", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "closed_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "finished_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "J", "read", "LOkioBuffer;J", "LJavaIoIOException;", "receive", "LOkioBufferedSource;J", "LOkhttp3InternalFramedFramedStream;" };
  static const J2ObjcClassInfo _Okhttp3InternalFramedFramedStream_FramedDataSource = { "FramedDataSource", "okhttp3.internal.framed", ptrTable, methods, fields, 7, 0x12, 7, 6, 6, -1, -1, -1, -1 };
  return &_Okhttp3InternalFramedFramedStream_FramedDataSource;
}

@end

void Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream_FramedDataSource *self, Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount) {
  JreStrongAssign(&self->this$0_, outer$);
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->receiveBuffer_, new_OkioBuffer_init());
  JreStrongAssignAndConsume(&self->readBuffer_, new_OkioBuffer_init());
  self->maxByteCount_ = maxByteCount;
}

Okhttp3InternalFramedFramedStream_FramedDataSource *new_Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount) {
  J2OBJC_NEW_IMPL(Okhttp3InternalFramedFramedStream_FramedDataSource, initWithOkhttp3InternalFramedFramedStream_withLong_, outer$, maxByteCount)
}

Okhttp3InternalFramedFramedStream_FramedDataSource *create_Okhttp3InternalFramedFramedStream_FramedDataSource_initWithOkhttp3InternalFramedFramedStream_withLong_(Okhttp3InternalFramedFramedStream *outer$, jlong maxByteCount) {
  J2OBJC_CREATE_IMPL(Okhttp3InternalFramedFramedStream_FramedDataSource, initWithOkhttp3InternalFramedFramedStream_withLong_, outer$, maxByteCount)
}

void Okhttp3InternalFramedFramedStream_FramedDataSource_waitUntilReadable(Okhttp3InternalFramedFramedStream_FramedDataSource *self) {
  [((Okhttp3InternalFramedFramedStream_StreamTimeout *) nil_chk(self->this$0_->readTimeout_)) enter];
  @try {
    while ([((OkioBuffer *) nil_chk(self->readBuffer_)) size] == 0 && !self->finished_ && !self->closed_ && self->this$0_->errorCode_ == nil) {
      Okhttp3InternalFramedFramedStream_waitForIo(self->this$0_);
    }
  }
  @finally {
    [self->this$0_->readTimeout_ exitAndThrowIfTimedOut];
  }
}

void Okhttp3InternalFramedFramedStream_FramedDataSource_checkNotClosed(Okhttp3InternalFramedFramedStream_FramedDataSource *self) {
  if (self->closed_) {
    @throw create_JavaIoIOException_initWithNSString_(@"stream closed");
  }
  if (self->this$0_->errorCode_ != nil) {
    @throw create_Okhttp3InternalFramedStreamResetException_initWithOkhttp3InternalFramedErrorCode_(self->this$0_->errorCode_);
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(Okhttp3InternalFramedFramedStream_FramedDataSource)

@implementation Okhttp3InternalFramedFramedStream_FramedDataSink

- (instancetype)initWithOkhttp3InternalFramedFramedStream:(Okhttp3InternalFramedFramedStream *)outer$ {
  Okhttp3InternalFramedFramedStream_FramedDataSink_initWithOkhttp3InternalFramedFramedStream_(self, outer$);
  return self;
}

- (void)writeWithOkioBuffer:(OkioBuffer *)source
                   withLong:(jlong)byteCount {
  JreAssert((!JavaLangThread_holdsLockWithId_(this$0_)), @"okhttp3/internal/framed/FramedStream.java:485 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  [((OkioBuffer *) nil_chk(sendBuffer_)) writeWithOkioBuffer:source withLong:byteCount];
  while ([sendBuffer_ size] >= Okhttp3InternalFramedFramedStream_FramedDataSink_EMIT_BUFFER_SIZE) {
    Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(self, false);
  }
}

- (void)emitDataFrameWithBoolean:(jboolean)outFinished {
  Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(self, outFinished);
}

- (void)flush {
  JreAssert((!JavaLangThread_holdsLockWithId_(this$0_)), @"okhttp3/internal/framed/FramedStream.java:522 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  @synchronized(this$0_) {
    Okhttp3InternalFramedFramedStream_checkOutNotClosed(this$0_);
  }
  while ([((OkioBuffer *) nil_chk(sendBuffer_)) size] > 0) {
    Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(self, false);
    [((Okhttp3InternalFramedFramedConnection *) nil_chk(this$0_->connection_)) flush];
  }
}

- (OkioTimeout *)timeout {
  return this$0_->writeTimeout_;
}

- (void)close {
  JreAssert((!JavaLangThread_holdsLockWithId_(this$0_)), @"okhttp3/internal/framed/FramedStream.java:537 condition failed: assert (!Thread.holdsLock(FramedStream.this));");
  @synchronized(this$0_) {
    if (closed_) return;
  }
  if (!((Okhttp3InternalFramedFramedStream_FramedDataSink *) nil_chk(this$0_->sink_))->finished_) {
    if ([((OkioBuffer *) nil_chk(sendBuffer_)) size] > 0) {
      while ([sendBuffer_ size] > 0) {
        Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(self, true);
      }
    }
    else {
      [((Okhttp3InternalFramedFramedConnection *) nil_chk(this$0_->connection_)) writeDataWithInt:this$0_->id__ withBoolean:true withOkioBuffer:nil withLong:0];
    }
  }
  @synchronized(this$0_) {
    closed_ = true;
  }
  [((Okhttp3InternalFramedFramedConnection *) nil_chk(this$0_->connection_)) flush];
  Okhttp3InternalFramedFramedStream_cancelStreamIfNecessary(this$0_);
}

- (void)dealloc {
  RELEASE_(this$0_);
  RELEASE_(sendBuffer_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 0, 1, 2, -1, -1, -1 },
    { NULL, "V", 0x2, 3, 4, 2, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 2, -1, -1, -1 },
    { NULL, "LOkioTimeout;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 2, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOkhttp3InternalFramedFramedStream:);
  methods[1].selector = @selector(writeWithOkioBuffer:withLong:);
  methods[2].selector = @selector(emitDataFrameWithBoolean:);
  methods[3].selector = @selector(flush);
  methods[4].selector = @selector(timeout);
  methods[5].selector = @selector(close);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", "LOkhttp3InternalFramedFramedStream;", .constantValue.asLong = 0, 0x1012, -1, -1, -1, -1 },
    { "EMIT_BUFFER_SIZE", "J", .constantValue.asLong = Okhttp3InternalFramedFramedStream_FramedDataSink_EMIT_BUFFER_SIZE, 0x1a, -1, -1, -1, -1 },
    { "sendBuffer_", "LOkioBuffer;", .constantValue.asLong = 0, 0x12, -1, -1, -1, -1 },
    { "closed_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "finished_", "Z", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "write", "LOkioBuffer;J", "LJavaIoIOException;", "emitDataFrame", "Z", "LOkhttp3InternalFramedFramedStream;" };
  static const J2ObjcClassInfo _Okhttp3InternalFramedFramedStream_FramedDataSink = { "FramedDataSink", "okhttp3.internal.framed", ptrTable, methods, fields, 7, 0x10, 6, 5, 5, -1, -1, -1, -1 };
  return &_Okhttp3InternalFramedFramedStream_FramedDataSink;
}

@end

void Okhttp3InternalFramedFramedStream_FramedDataSink_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream_FramedDataSink *self, Okhttp3InternalFramedFramedStream *outer$) {
  JreStrongAssign(&self->this$0_, outer$);
  NSObject_init(self);
  JreStrongAssignAndConsume(&self->sendBuffer_, new_OkioBuffer_init());
}

Okhttp3InternalFramedFramedStream_FramedDataSink *new_Okhttp3InternalFramedFramedStream_FramedDataSink_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream *outer$) {
  J2OBJC_NEW_IMPL(Okhttp3InternalFramedFramedStream_FramedDataSink, initWithOkhttp3InternalFramedFramedStream_, outer$)
}

Okhttp3InternalFramedFramedStream_FramedDataSink *create_Okhttp3InternalFramedFramedStream_FramedDataSink_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream *outer$) {
  J2OBJC_CREATE_IMPL(Okhttp3InternalFramedFramedStream_FramedDataSink, initWithOkhttp3InternalFramedFramedStream_, outer$)
}

void Okhttp3InternalFramedFramedStream_FramedDataSink_emitDataFrameWithBoolean_(Okhttp3InternalFramedFramedStream_FramedDataSink *self, jboolean outFinished) {
  jlong toWrite;
  @synchronized(self->this$0_) {
    [((Okhttp3InternalFramedFramedStream_StreamTimeout *) nil_chk(self->this$0_->writeTimeout_)) enter];
    @try {
      while (self->this$0_->bytesLeftInWriteWindow_ <= 0 && !self->finished_ && !self->closed_ && self->this$0_->errorCode_ == nil) {
        Okhttp3InternalFramedFramedStream_waitForIo(self->this$0_);
      }
    }
    @finally {
      [self->this$0_->writeTimeout_ exitAndThrowIfTimedOut];
    }
    Okhttp3InternalFramedFramedStream_checkOutNotClosed(self->this$0_);
    toWrite = JavaLangMath_minWithLong_withLong_(self->this$0_->bytesLeftInWriteWindow_, [((OkioBuffer *) nil_chk(self->sendBuffer_)) size]);
    self->this$0_->bytesLeftInWriteWindow_ -= toWrite;
  }
  [self->this$0_->writeTimeout_ enter];
  @try {
    [((Okhttp3InternalFramedFramedConnection *) nil_chk(self->this$0_->connection_)) writeDataWithInt:self->this$0_->id__ withBoolean:outFinished && toWrite == [self->sendBuffer_ size] withOkioBuffer:self->sendBuffer_ withLong:toWrite];
  }
  @finally {
    [self->this$0_->writeTimeout_ exitAndThrowIfTimedOut];
  }
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(Okhttp3InternalFramedFramedStream_FramedDataSink)

@implementation Okhttp3InternalFramedFramedStream_StreamTimeout

- (instancetype)initWithOkhttp3InternalFramedFramedStream:(Okhttp3InternalFramedFramedStream *)outer$ {
  Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(self, outer$);
  return self;
}

- (void)timedOut {
  [this$0_ closeLaterWithOkhttp3InternalFramedErrorCode:JreLoadEnum(Okhttp3InternalFramedErrorCode, CANCEL)];
}

- (JavaIoIOException *)newTimeoutExceptionWithJavaIoIOException:(JavaIoIOException *)cause {
  JavaNetSocketTimeoutException *socketTimeoutException = create_JavaNetSocketTimeoutException_initWithNSString_(@"timeout");
  if (cause != nil) {
    [socketTimeoutException initCauseWithJavaLangThrowable:cause];
  }
  return socketTimeoutException;
}

- (void)exitAndThrowIfTimedOut {
  if ([self exit]) @throw nil_chk([self newTimeoutExceptionWithJavaIoIOException:nil]);
}

- (void)dealloc {
  RELEASE_(this$0_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x4, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaIoIOException;", 0x4, 0, 1, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, 1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOkhttp3InternalFramedFramedStream:);
  methods[1].selector = @selector(timedOut);
  methods[2].selector = @selector(newTimeoutExceptionWithJavaIoIOException:);
  methods[3].selector = @selector(exitAndThrowIfTimedOut);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", "LOkhttp3InternalFramedFramedStream;", .constantValue.asLong = 0, 0x1012, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "newTimeoutException", "LJavaIoIOException;", "LOkhttp3InternalFramedFramedStream;" };
  static const J2ObjcClassInfo _Okhttp3InternalFramedFramedStream_StreamTimeout = { "StreamTimeout", "okhttp3.internal.framed", ptrTable, methods, fields, 7, 0x0, 4, 1, 2, -1, -1, -1, -1 };
  return &_Okhttp3InternalFramedFramedStream_StreamTimeout;
}

@end

void Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream_StreamTimeout *self, Okhttp3InternalFramedFramedStream *outer$) {
  JreStrongAssign(&self->this$0_, outer$);
  OkioAsyncTimeout_init(self);
}

Okhttp3InternalFramedFramedStream_StreamTimeout *new_Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream *outer$) {
  J2OBJC_NEW_IMPL(Okhttp3InternalFramedFramedStream_StreamTimeout, initWithOkhttp3InternalFramedFramedStream_, outer$)
}

Okhttp3InternalFramedFramedStream_StreamTimeout *create_Okhttp3InternalFramedFramedStream_StreamTimeout_initWithOkhttp3InternalFramedFramedStream_(Okhttp3InternalFramedFramedStream *outer$) {
  J2OBJC_CREATE_IMPL(Okhttp3InternalFramedFramedStream_StreamTimeout, initWithOkhttp3InternalFramedFramedStream_, outer$)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(Okhttp3InternalFramedFramedStream_StreamTimeout)
