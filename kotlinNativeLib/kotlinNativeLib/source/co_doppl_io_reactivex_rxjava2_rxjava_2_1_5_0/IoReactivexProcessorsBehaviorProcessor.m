//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IoReactivexAnnotationsCheckReturnValue.h"
#include "IoReactivexExceptionsMissingBackpressureException.h"
#include "IoReactivexInternalFunctionsObjectHelper.h"
#include "IoReactivexInternalSubscriptionsSubscriptionHelper.h"
#include "IoReactivexInternalUtilAppendOnlyLinkedArrayList.h"
#include "IoReactivexInternalUtilBackpressureHelper.h"
#include "IoReactivexInternalUtilExceptionHelper.h"
#include "IoReactivexInternalUtilNotificationLite.h"
#include "IoReactivexPluginsRxJavaPlugins.h"
#include "IoReactivexProcessorsBehaviorProcessor.h"
#include "IoReactivexProcessorsFlowableProcessor.h"
#include "J2ObjC_source.h"
#include "OrgReactivestreamsSubscriber.h"
#include "OrgReactivestreamsSubscription.h"
#include "java/lang/Long.h"
#include "java/lang/NullPointerException.h"
#include "java/lang/System.h"
#include "java/lang/Throwable.h"
#include "java/lang/annotation/Annotation.h"
#include "java/lang/reflect/Array.h"
#include "java/util/concurrent/atomic/AtomicLong.h"
#include "java/util/concurrent/atomic/AtomicReference.h"
#include "java/util/concurrent/locks/Lock.h"
#include "java/util/concurrent/locks/ReadWriteLock.h"
#include "java/util/concurrent/locks/ReentrantReadWriteLock.h"

__attribute__((unused)) static IOSObjectArray *IoReactivexProcessorsBehaviorProcessor__Annotations$0();

__attribute__((unused)) static IOSObjectArray *IoReactivexProcessorsBehaviorProcessor__Annotations$1();

inline jlong IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_get_serialVersionUID();
#define IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_serialVersionUID 3293175281126227086LL
J2OBJC_STATIC_FIELD_CONSTANT(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription, serialVersionUID, jlong)

J2OBJC_INITIALIZED_DEFN(IoReactivexProcessorsBehaviorProcessor)

IOSObjectArray *IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY;
IOSObjectArray *IoReactivexProcessorsBehaviorProcessor_EMPTY;
IOSObjectArray *IoReactivexProcessorsBehaviorProcessor_TERMINATED;

@implementation IoReactivexProcessorsBehaviorProcessor

+ (IOSObjectArray *)EMPTY_ARRAY {
  return IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY;
}

+ (IOSObjectArray *)EMPTY {
  return IoReactivexProcessorsBehaviorProcessor_EMPTY;
}

+ (IOSObjectArray *)TERMINATED {
  return IoReactivexProcessorsBehaviorProcessor_TERMINATED;
}

+ (IoReactivexProcessorsBehaviorProcessor *)create {
  return IoReactivexProcessorsBehaviorProcessor_create();
}

+ (IoReactivexProcessorsBehaviorProcessor *)createDefaultWithId:(id)defaultValue {
  return IoReactivexProcessorsBehaviorProcessor_createDefaultWithId_(defaultValue);
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  IoReactivexProcessorsBehaviorProcessor_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

- (instancetype)initWithId:(id)defaultValue {
  IoReactivexProcessorsBehaviorProcessor_initWithId_(self, defaultValue);
  return self;
}

- (void)subscribeActualWithOrgReactivestreamsSubscriber:(id<OrgReactivestreamsSubscriber>)s {
  IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *bs = create_IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_(s, self);
  [((id<OrgReactivestreamsSubscriber>) nil_chk(s)) onSubscribeWithOrgReactivestreamsSubscription:bs];
  if ([self addWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:bs]) {
    if (JreLoadVolatileBoolean(&bs->cancelled_)) {
      [self removeWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:bs];
    }
    else {
      [bs emitFirst];
    }
  }
  else {
    JavaLangThrowable *ex = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(terminalEvent_)) get];
    if (ex == JreLoadStatic(IoReactivexInternalUtilExceptionHelper, TERMINATED)) {
      [s onComplete];
    }
    else {
      [s onErrorWithJavaLangThrowable:ex];
    }
  }
}

- (void)onSubscribeWithOrgReactivestreamsSubscription:(id<OrgReactivestreamsSubscription>)s {
  if ([((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(terminalEvent_)) get] != nil) {
    [((id<OrgReactivestreamsSubscription>) nil_chk(s)) cancel];
    return;
  }
  [((id<OrgReactivestreamsSubscription>) nil_chk(s)) requestWithLong:JavaLangLong_MAX_VALUE];
}

- (void)onNextWithId:(id)t {
  if (t == nil) {
    [self onErrorWithJavaLangThrowable:create_JavaLangNullPointerException_initWithNSString_(@"onNext called with null. Null values are generally not allowed in 2.x operators and sources.")];
    return;
  }
  if ([((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(terminalEvent_)) get] != nil) {
    return;
  }
  id o = IoReactivexInternalUtilNotificationLite_nextWithId_(t);
  [self setCurrentWithId:o];
  {
    IOSObjectArray *a__ = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get];
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *bs = *b__++;
      [((IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *) nil_chk(bs)) emitNextWithId:o withLong:index_];
    }
  }
}

- (void)onErrorWithJavaLangThrowable:(JavaLangThrowable *)t {
  if (t == nil) {
    t = create_JavaLangNullPointerException_initWithNSString_(@"onError called with null. Null values are generally not allowed in 2.x operators and sources.");
  }
  if (![((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(terminalEvent_)) compareAndSetWithId:nil withId:t]) {
    IoReactivexPluginsRxJavaPlugins_onErrorWithJavaLangThrowable_(t);
    return;
  }
  id o = IoReactivexInternalUtilNotificationLite_errorWithJavaLangThrowable_(t);
  {
    IOSObjectArray *a__ = [self terminateWithId:o];
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *bs = *b__++;
      [((IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *) nil_chk(bs)) emitNextWithId:o withLong:index_];
    }
  }
}

- (void)onComplete {
  if (![((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(terminalEvent_)) compareAndSetWithId:nil withId:JreLoadStatic(IoReactivexInternalUtilExceptionHelper, TERMINATED)]) {
    return;
  }
  id o = IoReactivexInternalUtilNotificationLite_complete();
  {
    IOSObjectArray *a__ = [self terminateWithId:o];
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *bs = *b__++;
      [((IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *) nil_chk(bs)) emitNextWithId:o withLong:index_];
    }
  }
}

- (jboolean)offerWithId:(id)t {
  if (t == nil) {
    [self onErrorWithJavaLangThrowable:create_JavaLangNullPointerException_initWithNSString_(@"onNext called with null. Null values are generally not allowed in 2.x operators and sources.")];
    return true;
  }
  IOSObjectArray *array = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get];
  {
    IOSObjectArray *a__ = array;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *s = *b__++;
      if ([((IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *) nil_chk(s)) isFull]) {
        return false;
      }
    }
  }
  id o = IoReactivexInternalUtilNotificationLite_nextWithId_(t);
  [self setCurrentWithId:o];
  {
    IOSObjectArray *a__ = array;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *bs = *b__++;
      [((IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *) nil_chk(bs)) emitNextWithId:o withLong:index_];
    }
  }
  return true;
}

- (jboolean)hasSubscribers {
  return ((IOSObjectArray *) nil_chk([((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get]))->size_ != 0;
}

- (jint)subscriberCount {
  return ((IOSObjectArray *) nil_chk([((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get]))->size_;
}

- (JavaLangThrowable *)getThrowable {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  if (IoReactivexInternalUtilNotificationLite_isErrorWithId_(o)) {
    return IoReactivexInternalUtilNotificationLite_getErrorWithId_(o);
  }
  return nil;
}

- (id)getValue {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  if (IoReactivexInternalUtilNotificationLite_isCompleteWithId_(o) || IoReactivexInternalUtilNotificationLite_isErrorWithId_(o)) {
    return nil;
  }
  return IoReactivexInternalUtilNotificationLite_getValueWithId_(o);
}

- (IOSObjectArray *)getValues {
  IOSObjectArray *a = IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY;
  IOSObjectArray *b = [self getValuesWithNSObjectArray:a];
  if (b == IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY) {
    return [IOSObjectArray arrayWithLength:0 type:NSObject_class_()];
  }
  return b;
}

- (IOSObjectArray *)getValuesWithNSObjectArray:(IOSObjectArray *)array {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  if (o == nil || IoReactivexInternalUtilNotificationLite_isCompleteWithId_(o) || IoReactivexInternalUtilNotificationLite_isErrorWithId_(o)) {
    if (((IOSObjectArray *) nil_chk(array))->size_ != 0) {
      IOSObjectArray_Set(array, 0, nil);
    }
    return array;
  }
  id v = IoReactivexInternalUtilNotificationLite_getValueWithId_(o);
  if (((IOSObjectArray *) nil_chk(array))->size_ != 0) {
    IOSObjectArray_Set(array, 0, v);
    if (array->size_ != 1) {
      IOSObjectArray_Set(array, 1, nil);
    }
  }
  else {
    array = (IOSObjectArray *) cast_check(JavaLangReflectArray_newInstanceWithIOSClass_withInt_([[array java_getClass] getComponentType], 1), IOSClass_arrayType(NSObject_class_(), 1));
    IOSObjectArray_Set(nil_chk(array), 0, v);
  }
  return array;
}

- (jboolean)hasComplete {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  return IoReactivexInternalUtilNotificationLite_isCompleteWithId_(o);
}

- (jboolean)hasThrowable {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  return IoReactivexInternalUtilNotificationLite_isErrorWithId_(o);
}

- (jboolean)hasValue {
  id o = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) get];
  return o != nil && !IoReactivexInternalUtilNotificationLite_isCompleteWithId_(o) && !IoReactivexInternalUtilNotificationLite_isErrorWithId_(o);
}

- (jboolean)addWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *)rs {
  for (; ; ) {
    IOSObjectArray *a = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get];
    if (a == IoReactivexProcessorsBehaviorProcessor_TERMINATED) {
      return false;
    }
    jint len = ((IOSObjectArray *) nil_chk(a))->size_;
    IOSObjectArray *b = [IOSObjectArray arrayWithLength:len + 1 type:IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_class_()];
    JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(a, 0, b, 0, len);
    IOSObjectArray_Set(b, len, rs);
    if ([subscribers_ compareAndSetWithId:a withId:b]) {
      return true;
    }
  }
}

- (void)removeWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *)rs {
  for (; ; ) {
    IOSObjectArray *a = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get];
    if (a == IoReactivexProcessorsBehaviorProcessor_TERMINATED || a == IoReactivexProcessorsBehaviorProcessor_EMPTY) {
      return;
    }
    jint len = ((IOSObjectArray *) nil_chk(a))->size_;
    jint j = -1;
    for (jint i = 0; i < len; i++) {
      if (IOSObjectArray_Get(a, i) == rs) {
        j = i;
        break;
      }
    }
    if (j < 0) {
      return;
    }
    IOSObjectArray *b;
    if (len == 1) {
      b = IoReactivexProcessorsBehaviorProcessor_EMPTY;
    }
    else {
      b = [IOSObjectArray arrayWithLength:len - 1 type:IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_class_()];
      JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(a, 0, b, 0, j);
      JavaLangSystem_arraycopyWithId_withInt_withId_withInt_withInt_(a, j + 1, b, j, len - j - 1);
    }
    if ([subscribers_ compareAndSetWithId:a withId:b]) {
      return;
    }
  }
}

- (IOSObjectArray *)terminateWithId:(id)terminalValue {
  IOSObjectArray *a = [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(subscribers_)) get];
  if (a != IoReactivexProcessorsBehaviorProcessor_TERMINATED) {
    a = [subscribers_ getAndSetWithId:IoReactivexProcessorsBehaviorProcessor_TERMINATED];
    if (a != IoReactivexProcessorsBehaviorProcessor_TERMINATED) {
      [self setCurrentWithId:terminalValue];
    }
  }
  return a;
}

- (void)setCurrentWithId:(id)o {
  id<JavaUtilConcurrentLocksLock> wl = writeLock_;
  [((id<JavaUtilConcurrentLocksLock>) nil_chk(wl)) lock];
  index_++;
  [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(value_)) lazySetWithId:o];
  [wl unlock];
}

- (void)dealloc {
  RELEASE_(subscribers_);
  RELEASE_(lock_);
  RELEASE_(readLock_);
  RELEASE_(writeLock_);
  RELEASE_(value_);
  RELEASE_(terminalEvent_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, "LIoReactivexProcessorsBehaviorProcessor;", 0x9, -1, -1, -1, 0, 1, -1 },
    { NULL, "LIoReactivexProcessorsBehaviorProcessor;", 0x9, 2, 3, -1, 4, 5, -1 },
    { NULL, NULL, 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, NULL, 0x0, -1, 3, -1, 6, -1, -1 },
    { NULL, "V", 0x4, 7, 8, -1, 9, -1, -1 },
    { NULL, "V", 0x1, 10, 11, -1, -1, -1, -1 },
    { NULL, "V", 0x1, 12, 3, -1, 6, -1, -1 },
    { NULL, "V", 0x1, 13, 14, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 15, 3, -1, 16, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaLangThrowable;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "LNSObject;", 0x1, -1, -1, -1, 17, -1, -1 },
    { NULL, "[LNSObject;", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "[LNSObject;", 0x1, 18, 19, -1, 20, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x0, 21, 22, -1, 23, -1, -1 },
    { NULL, "V", 0x0, 24, 22, -1, 25, -1, -1 },
    { NULL, "[LIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription;", 0x0, 26, 3, -1, 27, -1, -1 },
    { NULL, "V", 0x0, 28, 3, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(create);
  methods[1].selector = @selector(createDefaultWithId:);
  methods[2].selector = @selector(init);
  methods[3].selector = @selector(initWithId:);
  methods[4].selector = @selector(subscribeActualWithOrgReactivestreamsSubscriber:);
  methods[5].selector = @selector(onSubscribeWithOrgReactivestreamsSubscription:);
  methods[6].selector = @selector(onNextWithId:);
  methods[7].selector = @selector(onErrorWithJavaLangThrowable:);
  methods[8].selector = @selector(onComplete);
  methods[9].selector = @selector(offerWithId:);
  methods[10].selector = @selector(hasSubscribers);
  methods[11].selector = @selector(subscriberCount);
  methods[12].selector = @selector(getThrowable);
  methods[13].selector = @selector(getValue);
  methods[14].selector = @selector(getValues);
  methods[15].selector = @selector(getValuesWithNSObjectArray:);
  methods[16].selector = @selector(hasComplete);
  methods[17].selector = @selector(hasThrowable);
  methods[18].selector = @selector(hasValue);
  methods[19].selector = @selector(addWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:);
  methods[20].selector = @selector(removeWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:);
  methods[21].selector = @selector(terminateWithId:);
  methods[22].selector = @selector(setCurrentWithId:);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "subscribers_", "LJavaUtilConcurrentAtomicAtomicReference;", .constantValue.asLong = 0, 0x10, -1, -1, 29, -1 },
    { "EMPTY_ARRAY", "[LNSObject;", .constantValue.asLong = 0, 0x18, -1, 30, -1, -1 },
    { "EMPTY", "[LIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription;", .constantValue.asLong = 0, 0x18, -1, 31, -1, -1 },
    { "TERMINATED", "[LIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription;", .constantValue.asLong = 0, 0x18, -1, 32, -1, -1 },
    { "lock_", "LJavaUtilConcurrentLocksReadWriteLock;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "readLock_", "LJavaUtilConcurrentLocksLock;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "writeLock_", "LJavaUtilConcurrentLocksLock;", .constantValue.asLong = 0, 0x10, -1, -1, -1, -1 },
    { "value_", "LJavaUtilConcurrentAtomicAtomicReference;", .constantValue.asLong = 0, 0x10, -1, -1, 33, -1 },
    { "terminalEvent_", "LJavaUtilConcurrentAtomicAtomicReference;", .constantValue.asLong = 0, 0x10, -1, -1, 34, -1 },
    { "index_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "<T:Ljava/lang/Object;>()Lio/reactivex/processors/BehaviorProcessor<TT;>;", (void *)&IoReactivexProcessorsBehaviorProcessor__Annotations$0, "createDefault", "LNSObject;", "<T:Ljava/lang/Object;>(TT;)Lio/reactivex/processors/BehaviorProcessor<TT;>;", (void *)&IoReactivexProcessorsBehaviorProcessor__Annotations$1, "(TT;)V", "subscribeActual", "LOrgReactivestreamsSubscriber;", "(Lorg/reactivestreams/Subscriber<-TT;>;)V", "onSubscribe", "LOrgReactivestreamsSubscription;", "onNext", "onError", "LJavaLangThrowable;", "offer", "(TT;)Z", "()TT;", "getValues", "[LNSObject;", "([TT;)[TT;", "add", "LIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription;", "(Lio/reactivex/processors/BehaviorProcessor$BehaviorSubscription<TT;>;)Z", "remove", "(Lio/reactivex/processors/BehaviorProcessor$BehaviorSubscription<TT;>;)V", "terminate", "(Ljava/lang/Object;)[Lio/reactivex/processors/BehaviorProcessor$BehaviorSubscription<TT;>;", "setCurrent", "Ljava/util/concurrent/atomic/AtomicReference<[Lio/reactivex/processors/BehaviorProcessor$BehaviorSubscription<TT;>;>;", &IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY, &IoReactivexProcessorsBehaviorProcessor_EMPTY, &IoReactivexProcessorsBehaviorProcessor_TERMINATED, "Ljava/util/concurrent/atomic/AtomicReference<Ljava/lang/Object;>;", "Ljava/util/concurrent/atomic/AtomicReference<Ljava/lang/Throwable;>;", "<T:Ljava/lang/Object;>Lio/reactivex/processors/FlowableProcessor<TT;>;" };
  static const J2ObjcClassInfo _IoReactivexProcessorsBehaviorProcessor = { "BehaviorProcessor", "io.reactivex.processors", ptrTable, methods, fields, 7, 0x11, 23, 10, -1, 22, -1, 35, -1 };
  return &_IoReactivexProcessorsBehaviorProcessor;
}

+ (void)initialize {
  if (self == [IoReactivexProcessorsBehaviorProcessor class]) {
    JreStrongAssignAndConsume(&IoReactivexProcessorsBehaviorProcessor_EMPTY_ARRAY, [IOSObjectArray newArrayWithLength:0 type:NSObject_class_()]);
    JreStrongAssignAndConsume(&IoReactivexProcessorsBehaviorProcessor_EMPTY, [IOSObjectArray newArrayWithLength:0 type:IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_class_()]);
    JreStrongAssignAndConsume(&IoReactivexProcessorsBehaviorProcessor_TERMINATED, [IOSObjectArray newArrayWithLength:0 type:IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_class_()]);
    J2OBJC_SET_INITIALIZED(IoReactivexProcessorsBehaviorProcessor)
  }
}

@end

IoReactivexProcessorsBehaviorProcessor *IoReactivexProcessorsBehaviorProcessor_create() {
  IoReactivexProcessorsBehaviorProcessor_initialize();
  return create_IoReactivexProcessorsBehaviorProcessor_init();
}

IoReactivexProcessorsBehaviorProcessor *IoReactivexProcessorsBehaviorProcessor_createDefaultWithId_(id defaultValue) {
  IoReactivexProcessorsBehaviorProcessor_initialize();
  IoReactivexInternalFunctionsObjectHelper_requireNonNullWithId_withNSString_(defaultValue, @"defaultValue is null");
  return create_IoReactivexProcessorsBehaviorProcessor_initWithId_(defaultValue);
}

void IoReactivexProcessorsBehaviorProcessor_init(IoReactivexProcessorsBehaviorProcessor *self) {
  IoReactivexProcessorsFlowableProcessor_init(self);
  JreStrongAssignAndConsume(&self->value_, new_JavaUtilConcurrentAtomicAtomicReference_init());
  JreStrongAssignAndConsume(&self->lock_, new_JavaUtilConcurrentLocksReentrantReadWriteLock_init());
  JreStrongAssign(&self->readLock_, [self->lock_ readLock]);
  JreStrongAssign(&self->writeLock_, [self->lock_ writeLock]);
  JreStrongAssignAndConsume(&self->subscribers_, new_JavaUtilConcurrentAtomicAtomicReference_initWithId_(IoReactivexProcessorsBehaviorProcessor_EMPTY));
  JreStrongAssignAndConsume(&self->terminalEvent_, new_JavaUtilConcurrentAtomicAtomicReference_init());
}

IoReactivexProcessorsBehaviorProcessor *new_IoReactivexProcessorsBehaviorProcessor_init() {
  J2OBJC_NEW_IMPL(IoReactivexProcessorsBehaviorProcessor, init)
}

IoReactivexProcessorsBehaviorProcessor *create_IoReactivexProcessorsBehaviorProcessor_init() {
  J2OBJC_CREATE_IMPL(IoReactivexProcessorsBehaviorProcessor, init)
}

void IoReactivexProcessorsBehaviorProcessor_initWithId_(IoReactivexProcessorsBehaviorProcessor *self, id defaultValue) {
  IoReactivexProcessorsBehaviorProcessor_init(self);
  [((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(self->value_)) lazySetWithId:IoReactivexInternalFunctionsObjectHelper_requireNonNullWithId_withNSString_(defaultValue, @"defaultValue is null")];
}

IoReactivexProcessorsBehaviorProcessor *new_IoReactivexProcessorsBehaviorProcessor_initWithId_(id defaultValue) {
  J2OBJC_NEW_IMPL(IoReactivexProcessorsBehaviorProcessor, initWithId_, defaultValue)
}

IoReactivexProcessorsBehaviorProcessor *create_IoReactivexProcessorsBehaviorProcessor_initWithId_(id defaultValue) {
  J2OBJC_CREATE_IMPL(IoReactivexProcessorsBehaviorProcessor, initWithId_, defaultValue)
}

IOSObjectArray *IoReactivexProcessorsBehaviorProcessor__Annotations$0() {
  return [IOSObjectArray arrayWithObjects:(id[]){ create_IoReactivexAnnotationsCheckReturnValue() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

IOSObjectArray *IoReactivexProcessorsBehaviorProcessor__Annotations$1() {
  return [IOSObjectArray arrayWithObjects:(id[]){ create_IoReactivexAnnotationsCheckReturnValue() } count:1 type:JavaLangAnnotationAnnotation_class_()];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(IoReactivexProcessorsBehaviorProcessor)

@implementation IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription

- (instancetype)initWithOrgReactivestreamsSubscriber:(id<OrgReactivestreamsSubscriber>)actual
          withIoReactivexProcessorsBehaviorProcessor:(IoReactivexProcessorsBehaviorProcessor *)state {
  IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_(self, actual, state);
  return self;
}

- (void)requestWithLong:(jlong)n {
  if (IoReactivexInternalSubscriptionsSubscriptionHelper_validateWithLong_(n)) {
    IoReactivexInternalUtilBackpressureHelper_addWithJavaUtilConcurrentAtomicAtomicLong_withLong_(self, n);
  }
}

- (void)cancel {
  if (!JreLoadVolatileBoolean(&cancelled_)) {
    JreAssignVolatileBoolean(&cancelled_, true);
    [((IoReactivexProcessorsBehaviorProcessor *) nil_chk(state_)) removeWithIoReactivexProcessorsBehaviorProcessor_BehaviorSubscription:self];
  }
}

- (void)emitFirst {
  if (JreLoadVolatileBoolean(&cancelled_)) {
    return;
  }
  id o;
  @synchronized(self) {
    if (JreLoadVolatileBoolean(&cancelled_)) {
      return;
    }
    if (next_) {
      return;
    }
    IoReactivexProcessorsBehaviorProcessor *s = state_;
    id<JavaUtilConcurrentLocksLock> readLock = ((IoReactivexProcessorsBehaviorProcessor *) nil_chk(s))->readLock_;
    [((id<JavaUtilConcurrentLocksLock>) nil_chk(readLock)) lock];
    index_ = s->index_;
    o = JreRetainedLocalValue([((JavaUtilConcurrentAtomicAtomicReference *) nil_chk(s->value_)) get]);
    [readLock unlock];
    emitting_ = (o != nil);
    next_ = true;
  }
  if (o != nil) {
    if ([self testWithId:o]) {
      return;
    }
    [self emitLoop];
  }
}

- (void)emitNextWithId:(id)value
              withLong:(jlong)stateIndex {
  if (JreLoadVolatileBoolean(&cancelled_)) {
    return;
  }
  if (!fastPath_) {
    @synchronized(self) {
      if (JreLoadVolatileBoolean(&cancelled_)) {
        return;
      }
      if (index_ == stateIndex) {
        return;
      }
      if (emitting_) {
        IoReactivexInternalUtilAppendOnlyLinkedArrayList *q = queue_;
        if (q == nil) {
          q = create_IoReactivexInternalUtilAppendOnlyLinkedArrayList_initWithInt_(4);
          JreStrongAssign(&queue_, q);
        }
        [q addWithId:value];
        return;
      }
      next_ = true;
    }
    fastPath_ = true;
  }
  [self testWithId:value];
}

- (jboolean)testWithId:(id)o {
  if (JreLoadVolatileBoolean(&cancelled_)) {
    return true;
  }
  if (IoReactivexInternalUtilNotificationLite_isCompleteWithId_(o)) {
    [((id<OrgReactivestreamsSubscriber>) nil_chk(actual_)) onComplete];
    return true;
  }
  else if (IoReactivexInternalUtilNotificationLite_isErrorWithId_(o)) {
    [((id<OrgReactivestreamsSubscriber>) nil_chk(actual_)) onErrorWithJavaLangThrowable:IoReactivexInternalUtilNotificationLite_getErrorWithId_(o)];
    return true;
  }
  jlong r = [self get];
  if (r != 0LL) {
    [((id<OrgReactivestreamsSubscriber>) nil_chk(actual_)) onNextWithId:IoReactivexInternalUtilNotificationLite_getValueWithId_(o)];
    if (r != JavaLangLong_MAX_VALUE) {
      [self decrementAndGet];
    }
    return false;
  }
  [self cancel];
  [((id<OrgReactivestreamsSubscriber>) nil_chk(actual_)) onErrorWithJavaLangThrowable:create_IoReactivexExceptionsMissingBackpressureException_initWithNSString_(@"Could not deliver value due to lack of requests")];
  return true;
}

- (void)emitLoop {
  for (; ; ) {
    if (JreLoadVolatileBoolean(&cancelled_)) {
      return;
    }
    IoReactivexInternalUtilAppendOnlyLinkedArrayList *q;
    @synchronized(self) {
      q = JreRetainedLocalValue(queue_);
      if (q == nil) {
        emitting_ = false;
        return;
      }
      JreStrongAssign(&queue_, nil);
    }
    [q forEachWhileWithIoReactivexInternalUtilAppendOnlyLinkedArrayList_NonThrowingPredicate:self];
  }
}

- (jboolean)isFull {
  return [self get] == 0LL;
}

- (jboolean)isEqual:(id)obj {
  return self == obj;
}

- (NSUInteger)hash {
  return (NSUInteger)self;
}

- (void)dealloc {
  RELEASE_(actual_);
  RELEASE_(state_);
  RELEASE_(queue_);
  [super dealloc];
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x0, -1, 0, -1, 1, -1, -1 },
    { NULL, "V", 0x1, 2, 3, -1, -1, -1, -1 },
    { NULL, "V", 0x1, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "V", 0x0, 4, 5, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, 6, 7, -1, -1, -1, -1 },
    { NULL, "V", 0x0, -1, -1, -1, -1, -1, -1 },
    { NULL, "Z", 0x1, -1, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  methods[0].selector = @selector(initWithOrgReactivestreamsSubscriber:withIoReactivexProcessorsBehaviorProcessor:);
  methods[1].selector = @selector(requestWithLong:);
  methods[2].selector = @selector(cancel);
  methods[3].selector = @selector(emitFirst);
  methods[4].selector = @selector(emitNextWithId:withLong:);
  methods[5].selector = @selector(testWithId:);
  methods[6].selector = @selector(emitLoop);
  methods[7].selector = @selector(isFull);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "serialVersionUID", "J", .constantValue.asLong = IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_serialVersionUID, 0x1a, -1, -1, -1, -1 },
    { "actual_", "LOrgReactivestreamsSubscriber;", .constantValue.asLong = 0, 0x10, -1, -1, 8, -1 },
    { "state_", "LIoReactivexProcessorsBehaviorProcessor;", .constantValue.asLong = 0, 0x10, -1, -1, 9, -1 },
    { "next_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "emitting_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "queue_", "LIoReactivexInternalUtilAppendOnlyLinkedArrayList;", .constantValue.asLong = 0, 0x0, -1, -1, 10, -1 },
    { "fastPath_", "Z", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
    { "cancelled_", "Z", .constantValue.asLong = 0, 0x40, -1, -1, -1, -1 },
    { "index_", "J", .constantValue.asLong = 0, 0x0, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "LOrgReactivestreamsSubscriber;LIoReactivexProcessorsBehaviorProcessor;", "(Lorg/reactivestreams/Subscriber<-TT;>;Lio/reactivex/processors/BehaviorProcessor<TT;>;)V", "request", "J", "emitNext", "LNSObject;J", "test", "LNSObject;", "Lorg/reactivestreams/Subscriber<-TT;>;", "Lio/reactivex/processors/BehaviorProcessor<TT;>;", "Lio/reactivex/internal/util/AppendOnlyLinkedArrayList<Ljava/lang/Object;>;", "LIoReactivexProcessorsBehaviorProcessor;", "<T:Ljava/lang/Object;>Ljava/util/concurrent/atomic/AtomicLong;Lorg/reactivestreams/Subscription;Lio/reactivex/internal/util/AppendOnlyLinkedArrayList$NonThrowingPredicate<Ljava/lang/Object;>;" };
  static const J2ObjcClassInfo _IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription = { "BehaviorSubscription", "io.reactivex.processors", ptrTable, methods, fields, 7, 0x18, 8, 9, 11, -1, -1, 12, -1 };
  return &_IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription;
}

@end

void IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *self, id<OrgReactivestreamsSubscriber> actual, IoReactivexProcessorsBehaviorProcessor *state) {
  JavaUtilConcurrentAtomicAtomicLong_init(self);
  JreStrongAssign(&self->actual_, actual);
  JreStrongAssign(&self->state_, state);
}

IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *new_IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_(id<OrgReactivestreamsSubscriber> actual, IoReactivexProcessorsBehaviorProcessor *state) {
  J2OBJC_NEW_IMPL(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription, initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_, actual, state)
}

IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription *create_IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription_initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_(id<OrgReactivestreamsSubscriber> actual, IoReactivexProcessorsBehaviorProcessor *state) {
  J2OBJC_CREATE_IMPL(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription, initWithOrgReactivestreamsSubscriber_withIoReactivexProcessorsBehaviorProcessor_, actual, state)
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(IoReactivexProcessorsBehaviorProcessor_BehaviorSubscription)
